<!DOCTYPE html>
<html>
<head>
    <title>Smart Content Analysis System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; text-align: center; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .full-width { grid-column: 1 / -1; }
        button { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin: 8px; font-size: 14px; }
        button:hover { background: #5a67d8; }
        button:disabled { background: #cbd5e0; cursor: not-allowed; }
        .source-btn { background: #48bb78; }
        .source-btn:hover { background: #38a169; }
        .analyze-btn { background: #ed8936; }
        .analyze-btn:hover { background: #dd6b20; }
        .text-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; margin: 10px 0; font-size: 14px; }
        .results { background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 8px; font-family: monospace; max-height: 400px; overflow-y: auto; }
        .status { padding: 10px; border-radius: 6px; margin: 10px 0; }
        .status.success { background: #c6f6d5; color: #22543d; }
        .status.error { background: #fed7d7; color: #742a2a; }
        .status.info { background: #bee3f8; color: #2a4365; }
        .metric { display: inline-block; background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; margin: 5px; font-size: 12px; }
        .insight { background: #f7fafc; border-left: 4px solid #667eea; padding: 15px; margin: 10px 0; }
        .loading { text-align: center; padding: 20px; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† Smart Content Analysis System</h1>
            <p>AI-powered content analysis with sentiment detection and trend insights</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>üìä Content Sources</h3>
                <p>Select content source for analysis:</p>
                <button class="source-btn" onclick="startAnalysis('twitter')">Twitter Posts</button>
                <button class="source-btn" onclick="startAnalysis('news')">News Articles</button>
                <button class="source-btn" onclick="startAnalysis('reviews')">Product Reviews</button>
                <button class="source-btn" onclick="startAnalysis('mixed')">Mixed Content</button>
            </div>

            <div class="card">
                <h3>üîç Quick Text Analysis</h3>
                <textarea id="custom-text" class="text-input" rows="4" placeholder="Enter text to analyze sentiment..."></textarea>
                <button class="analyze-btn" onclick="analyzeCustomText()">Analyze Text</button>
                <div id="text-result"></div>
            </div>
        </div>

        <div class="card full-width">
            <h3>üìà Analysis Results</h3>
            <div id="status-area"></div>
            <div id="metrics-area"></div>
            <div id="results-area" class="results">
                Ready to analyze content. Select a source above to begin.
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>üí° Key Insights</h3>
                <div id="insights-area">
                    <p>Insights will appear here after analysis...</p>
                </div>
            </div>

            <div class="card">
                <h3>üìã Recommendations</h3>
                <div id="recommendations-area">
                    <p>Recommendations will appear here after analysis...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let analysisInProgress = false;

        function startAnalysis(source) {
            if (analysisInProgress) return;
            
            analysisInProgress = true;
            updateButtons(true);
            
            document.getElementById('status-area').innerHTML = 
                '<div class="status info">üöÄ Starting analysis for ' + source + ' content...</div>';
            
            document.getElementById('results-area').innerHTML = 
                '<div class="loading"><div class="spinner"></div><p>Analysis in progress...</p></div>';

            fetch('/api/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({source: source})
            });
        }

        function analyzeCustomText() {
            const text = document.getElementById('custom-text').value.trim();
            if (!text) return;

            const resultDiv = document.getElementById('text-result');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';

            fetch('/api/analyze_text', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({text: text})
            })
            .then(response => response.json())
            .then(data => {
                if (data.analysis_successful) {
                    const sentiment = data.sentiment;
                    const confidence = Math.round(data.confidence * 100);
                    const color = sentiment === 'positive' ? '#48bb78' : 
                                 sentiment === 'negative' ? '#f56565' : '#ed8936';
                    
                    resultDiv.innerHTML = `
                        <div style="margin-top: 10px; padding: 10px; background: ${color}20; border-radius: 6px;">
                            <strong>Sentiment:</strong> <span style="color: ${color}">${sentiment.toUpperCase()}</span><br>
                            <strong>Confidence:</strong> ${confidence}%
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="status error">Analysis failed</div>';
                }
            });
        }

        function updateButtons(disabled) {
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = disabled);
        }

        socket.on('analysis_started', (data) => {
            document.getElementById('status-area').innerHTML = 
                '<div class="status info">üìä Collecting content from ' + data.source + '...</div>';
        });

        socket.on('analysis_complete', (data) => {
            analysisInProgress = false;
            updateButtons(false);
            
            if (data.status === 'success') {
                document.getElementById('status-area').innerHTML = 
                    '<div class="status success">‚úÖ Analysis completed successfully!</div>';
                
                displayResults(data);
            } else {
                document.getElementById('status-area').innerHTML = 
                    '<div class="status error">‚ùå Analysis failed: ' + (data.error || 'Unknown error') + '</div>';
                document.getElementById('results-area').innerHTML = 'Analysis failed. Please try again.';
            }
        });

        socket.on('analysis_error', (data) => {
            analysisInProgress = false;
            updateButtons(false);
            document.getElementById('status-area').innerHTML = 
                '<div class="status error">‚ùå Error: ' + data.error + '</div>';
        });

        function displayResults(data) {
            const summary = data.summary;
            const results = data.results;

            // Display metrics
            document.getElementById('metrics-area').innerHTML = `
                <div class="metric">üìä ${summary.content_items} Items</div>
                <div class="metric">üí≠ ${summary.sentiment_analyzed} Analyzed</div>
                <div class="metric">üìà ${summary.overall_sentiment.toUpperCase()}</div>
                <div class="metric">üí° ${summary.key_insights} Insights</div>
            `;

            // Display detailed results
            let resultsHtml = '<h4>üìä Analysis Summary</h4>';
            resultsHtml += `<p><strong>Overall Sentiment:</strong> ${summary.overall_sentiment}</p>`;
            
            if (results.sentiment && results.sentiment.summary) {
                const sentimentSummary = results.sentiment.summary;
                resultsHtml += '<h4>üí≠ Sentiment Breakdown</h4>';
                resultsHtml += `<p>Positive: ${sentimentSummary.positive || 0} | `;
                resultsHtml += `Negative: ${sentimentSummary.negative || 0} | `;
                resultsHtml += `Neutral: ${sentimentSummary.neutral || 0}</p>`;
            }

            document.getElementById('results-area').innerHTML = resultsHtml;

            // Display insights
            if (results.trends && results.trends.key_insights) {
                const insights = results.trends.key_insights;
                let insightsHtml = '';
                insights.forEach(insight => {
                    insightsHtml += `<div class="insight">üí° ${insight}</div>`;
                });
                document.getElementById('insights-area').innerHTML = insightsHtml || '<p>No specific insights found.</p>';
            }

            // Display recommendations
            if (results.report && results.report.recommendations) {
                const recommendations = results.report.recommendations;
                let recHtml = '<ul>';
                recommendations.slice(0, 4).forEach(rec => {
                    recHtml += `<li>${rec}</li>`;
                });
                recHtml += '</ul>';
                document.getElementById('recommendations-area').innerHTML = recHtml;
            }
        }

        // Initialize
        socket.emit('request_status');
    </script>
</body>
</html>